version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: {{ .Values.machineToken }}
  ca:
    crt: {{ .Values.machineCA }}
  kubelet:
    image: ghcr.io/siderolabs/kubelet:{{ .Kubernetes.Version }}
    defaultRuntimeSeccompProfileEnabled: true
    extraConfig:
      {{- .Kubernetes.KubeletConfiguration | toYamlPretty | nindent 6 }}
  sysfs:
    {{- with .Resources.Hugepages1Gi }}
    devices/system/node/node0/hugepages/hugepages-1048576kB/nr_hugepages: {{ . }}
    {{- end }}
    {{- with .Resources.Hugepages2Mi }}
    devices/system/node/node0/hugepages/hugepages-2048kB/nr_hugepages: {{ . }}
    {{- end }}
  install:
    wipe: true
  features:
      rbac: true
      stableHostname: true
      apidCheckExtKeyUsage: true
      diskQuotaSupport: true
cluster:
  id: {{ .Values.clusterID }}
  secret: {{ .Values.clusterSecret }}
  controlPlane:
    endpoint: {{ .Values.clusterEndpoint }}
  clusterName: {{ .Values.clusterName}}
  network:
    dnsDomain: cluster.local
    podSubnets:
      - 10.244.0.0/16
    serviceSubnets:
      - 10.96.0.0/12
  token: {{ .Kubernetes.BootstrapToken }}
  ca:
    crt: {{ .Kubernetes.RootCA | b64enc | quote }}
